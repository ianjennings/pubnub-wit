<html>
<head>
  <link rel="stylesheet" href="microphone.css">
  <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet">
</head>
<body>

  <div class="container">

    <div class="row">
      <div class="col-md-3">
      </div>
      <div class="col-md-6">

        <div class="well">
          <div id="box"></div>
        </div>

        <div class="well">

          <div id="microphone"></div>
          <script src="microphone.js"></script>
          <div id="info"></div>

        </div>

      </div>
      <div class="col-md-3">
      </div>
    </div>

  </div>

  <!-- http://www.pubnub.com/blog/build-real-time-chat-10-lines-code/ -->
  <script src="http://cdn.pubnub.com/pubnub.min.js"></script>

  <script>

    var
      box = PUBNUB.$('box'),
      channel = 'my_channel';

    PUBNUB.subscribe({
      channel: channel,
      callback: function(text) {
        box.innerHTML = (''+text).replace( /[<>]/g, '' ) + '<br>' + box.innerHTML
      }
    });

    var mic = new Wit.Microphone(document.getElementById("microphone"));

    var info = function (msg) {
      document.getElementById("info").innerHTML = msg;
    };
    mic.onready = function () {
      info("Microphone is ready to record");
    };
    mic.onaudiostart = function () {
      info("Recording started");
    };
    mic.onaudioend = function () {
      info("Recording stopped, processing started");
    };
    mic.onerror = function (err) {
      info("Error: " + err);
    };

    mic.onresult = function (intent, entities) {

      if (intent == "message") {

        if(typeof entities.message_body !== "undefined") {
          PUBNUB.publish({
            channel: channel,
            message: entities.message_body.body
          });
        }

      }

    };

    mic.connect("PYKE2SEOG5SO46P2XMUXQOJTA77MT6FH");

  </script>
</body>
</html>
