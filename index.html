<html>
<head>
  <link rel="stylesheet" href="microphone.css">
</head>
<body style="text-align: center;">

  <div id="microphone"></div>
  <pre id="result"></pre>
  <div id="info"></div>
  <script src="microphone.js"></script>
  <div id="box"></div>
  <input type="text" id="input">

  <!-- http://www.pubnub.com/blog/build-real-time-chat-10-lines-code/ -->
  <script src="http://cdn.pubnub.com/pubnub.min.js"></script>

  <script>

    var
      box = PUBNUB.$('box'),
      input = PUBNUB.$('input'),
      channel = 'my_channel';

    PUBNUB.subscribe({
      channel: channel,
      callback: function(text) {
        box.innerHTML = (''+text).replace( /[<>]/g, '' ) + '<br>' + box.innerHTML
      }
    });

    PUBNUB.bind( 'keyup', input, function(e) {
      (e.keyCode || e.charCode) === 13 && PUBNUB.publish({
        channel: channel,
        message: input.value,
        x: (input.value='')
      });
    });

    var mic = new Wit.Microphone(document.getElementById("microphone"));

    var info = function (msg) {
      document.getElementById("info").innerHTML = msg;
    };
    mic.onready = function () {
      info("Microphone is ready to record");
    };
    mic.onaudiostart = function () {
      info("Recording started");
    };
    mic.onaudioend = function () {
      info("Recording stopped, processing started");
    };
    mic.onerror = function (err) {
      info("Error: " + err);
    };

    mic.onresult = function (intent, entities) {

      document.getElementById("result").innerHTML = intent;

      if (intent == "message") {

        PUBNUB.publish({
          channel: channel,
          message: entities.message_body.body
        });

      }

    };

    mic.connect("PYKE2SEOG5SO46P2XMUXQOJTA77MT6FH");

  </script>
</body>
</html>
